# mgnet 整体架构

---

1. 服务器
	1. gate	用户代理服务
	1. game	游戏逻辑服务器
	1. chat	聊天服务器
	1. crossGame	跨服服务器
	1. login 登录服务器
	1. hub	中心服务器	`中心服务，此服务待定`
		* hub服务器启动 内网IP和端口，等待gate服务和普通服务器连接
	1. task	任务服务器 `待定`
	1. activity	运营活动服务器 `待定`
	

2. 架构相关常量

##  1 服务器


### 1.1 服务器流程图

	game		chat		crossGame		login
	|			|			|				|
	|			|			|				|
	|			|			|				|
	↑			↑			↑				↑
	gate -------↑-----------↑---------------↑
	|
	↓
	Player



### 1.1 gate 用户代理服务

* gate服启动后会连接功能服务器，如游戏逻辑game服务器，chat聊天服务器，login登录服务器，crossGame跨服服务器（如果有）
* 玩家所有请求都由gate转发，gate会把相关的数据包转发到相关服务上
* 数据包中target参数标识哪个服务，refer来路服务，url RPC服ID
* gate连接其他服务流程

### 1.2 game	游戏逻辑服务器



### 1.3 chat	聊天服务器



### 1.8 login 登录服务器

* 



### 1.4 crossGame	跨服服务器



### 1.5 hub	中心服务器	`待定`
### 1.6 task	任务服务器 `待定`
### 1.7 activity	运营活动服务器 `待定`






1. 服务器验证流程

## 服务器架构设计 
* 每个游戏单个游戏服包括：1游戏主逻辑服务，2chat聊天服务
* 跨服活动数据交换通过crossGame服务进行交换 
* 每个服务前都有一个gate服务进行数据代理

## 1 服务器 & 以及服务器功能



## 1 服务器Socket连接规则 

	game		chat		crossGame
	|			|			|
	|			|			|
	|			|			|
	↑			↑			↑
	gate -------↑-----------↑
	|
	↓
	Player

## 用户ID生成规则

用户ID例如：	1000	10000	1000000

第一段平台ID,最多9999

第二段服务器ID，最多99999

第三段用户自增ID，最多9999999，百万

## Session ID生成规则

ptID	+	serverId	+	time.UnixNano	+	服务器密钥

`此密钥永远不可以在前端保存已免被破解`



##  2 架构相关常量



## 1 RPC



名称 /library/module/types/rpc.proto	Routing
 
说明：路由类型，消息体外层结构

结构 

字段名 | 类型 | 默认值 | 描述 
--- 	| --- | --- | -
target | uint32 | - | 目标服务
refer | uint32 | - | 来路服务
url | uint32 | - | 功能ID
sessId | string | - | Session Id
msg | bytes | - | body
gmt | uint32 | - | 时间戳
code | uint32 | - | 状态代码，0为正常，大于0为异常
error | string | - | 如果有错误，这里是错误内容


