# mgnet 整体架构

---


1. 服务器验证流程

## 服务器架构设计 
* 每个游戏单个游戏服包括：1游戏主逻辑服务，2chat聊天服务
* 跨服活动数据交换通过crossGame服务进行交换 
* 每个服务前都有一个gate服务进行数据代理

## 1 服务器 & 以及服务器功能

* gate	用户代理服务
* game	游戏逻辑服务器
* chat	聊天服务器
* crossGame	跨服服务器
* hub	中心服务器	`中心服务，此服务待定`
	* hub服务器启动 内网IP和端口，等待gate服务和普通服务器连接
* task	任务服务器 `待定`
* activity	运营活动服务器 `待定`

## 1 服务器Socket连接规则 

	game		chat		crossGame
	|			|			|
	|			|			|
	|			|			|
	gate		gate		gate
	|			↑			↑
	|-----------↑			↑
	|-----------------------↑
	|
	↓
	Player

## 用户ID生成规则

用户ID例如：	1000	10000	1000000

第一段平台ID

第二段服务器ID

第三段用户自增ID 

## Session ID生成规则

ptID	+	serverId	+	time.UnixNano	+	服务器密钥

`此密钥永远不可以在前端保存已免被破解`




## 1 RPC

名称 /library/module/types/rpc.proto	Routing
 
说明：路由类型，消息体外层结构

结构 

字段名 | 类型 | 默认值 | 描述 
--- 	| --- | --- | -
target | uint32 | - | 目标服务
refer | uint32 | - | 来路服务
url | uint32 | - | 功能ID
sessId | string | - | Session Id
msg | bytes | - | body
gmt | uint32 | - | 时间戳
code | uint32 | - | 状态代码，0为正常，大于0为异常
error | string | - | 如果有错误，这里是错误内容


